<form #forgotPasswordForm="ngForm" (ngSubmit)="nextStep(forgotPasswordForm)" class="my-10 space-y-6">
  <!-- First Step: Email Form -->
  <div *ngIf="currentStep === 1">
    <div class="text-center">
      <h2 class="text-foreground mb-1 text-3xl font-semibold">Forgot Password <span class="text-main-color">?</span></h2>
      <p class="text-muted-foreground text-sm">Enter your email to reset your password.</p>
    </div>

    <div class="space-y-3 text-left">
      <div class="relative">
        <input 
          type="email" 
          id="email" 
          name="email"
          [(ngModel)]="email" 
          class="peer block w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder=" " 
          pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}" 
          required 
        />
        <label 
          for="email" 
          class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 left-1 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2">
          Email address
        </label>
      </div>
    </div>
    <div class="py-3"></div>
    <div class="flex justify-between space-x-2">
      <div class="w-full">
        <button 
          type="button"
          routerLink="/auth/sign-in"
          class="w-full font-bold shadow-sm bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md px-4 py-2 text-base">
          Cancel
        </button>
      </div>
      <div class="w-full">
        <button 
          type="submit"
          [disabled]="forgotPasswordForm.invalid"
          class="w-full font-bold shadow-md bg-primary text-white hover:bg-primary-dark rounded-md px-4 py-2 text-base disabled:opacity-50 disabled:cursor-not-allowed">
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Second Step: OTP Form -->
  <div *ngIf="currentStep === 2">
    <div class="text-center">
      <p class="text-muted-foreground text-sm">Enter the 6-digit OTP code sent to your email</p>
    </div>
    <div class="space-y-3 text-left">
      <div class="relative">
        <input 
          type="text" 
          id="otp" 
          name="otp"
          [(ngModel)]="otp" 
          class="peer block w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder=" "
          required
          pattern="[0-9]{6}"
          maxlength="6"
        />
        <label 
          for="otp" 
          class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 left-1 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2">
          Enter OTP code
        </label>
      </div>
    </div>
    <div class="py-3"></div>
    <div class="flex justify-between space-x-2">
      <div class="w-full">
        <button 
          type="button"
          (click)="prevStep()"
          class="w-full font-bold shadow-sm bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md px-4 py-2 text-base">
          Back
        </button>
      </div>
      <div class="w-full">
        <button 
          type="submit"
          [disabled]="forgotPasswordForm.invalid"
          class="w-full font-bold shadow-md bg-primary text-white hover:bg-primary-dark rounded-md px-4 py-2 text-base disabled:opacity-50 disabled:cursor-not-allowed">
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Third Step: New Password Form -->
  <div *ngIf="currentStep === 3">
    <div class="text-center">
      <p class="text-muted-foreground text-sm">Enter Your New Password</p>
    </div>
    <div class="space-y-3 text-left">
      <div class="relative">
        <input 
          type="password" 
          id="new-password" 
          name="newPassword"
          [(ngModel)]="newPassword" 
          class="peer block w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder=" "
          required
          minlength="8"
        />
        <label 
          for="new-password" 
          class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 left-1 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2">
          Enter new password
        </label>
      </div>
      <div class="relative">
        <input 
          type="password" 
          id="confirm-password" 
          name="confirmPassword"
          [(ngModel)]="confirmPassword" 
          class="peer block w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder=" "
          required
          minlength="8"
        />
        <label 
          for="confirm-password" 
          class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 left-1 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2">
          Confirm password
        </label>
      </div>
    </div>
    <div class="py-3"></div>
    <div class="flex justify-between space-x-2">
      <div class="w-full">
        <button 
          type="button"
          (click)="prevStep()"
          class="w-full font-bold shadow-sm bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md px-4 py-2 text-base">
          Back
        </button>
      </div>
      <div class="w-full">
        <button 
          type="button"
          (click)="submit()"
          [disabled]="forgotPasswordForm.invalid"
          class="w-full font-bold shadow-md bg-primary text-white hover:bg-primary-dark rounded-md px-4 py-2 text-base disabled:opacity-50 disabled:cursor-not-allowed">
          Submit
        </button>
      </div>
    </div>
  </div>

  <!-- Stepper UI -->
  <div class="flex justify-center mb-6">
    <div class="flex items-center space-x-4">
      <div class="flex flex-col items-center">
        <div [ngClass]="{'bg-primary text-white': currentStep >= 1, 'bg-gray-200 text-gray-500': currentStep < 1}" class="flex items-center justify-center w-10 h-10 rounded-full">
          1
        </div>
        <span class="text-sm mt-2">Email</span>
      </div>
      <div class="flex-1 h-1 bg-gray-200" [ngClass]="{'bg-primary': currentStep >= 2}"></div>
      <div class="flex flex-col items-center">
        <div [ngClass]="{'bg-primary text-white': currentStep >= 2, 'bg-gray-200 text-gray-500': currentStep < 2}" class="flex items-center justify-center w-10 h-10 rounded-full">
          2
        </div>
        <span class="text-sm mt-2">OTP</span>
      </div>
      <div class="flex-1 h-1 bg-gray-200" [ngClass]="{'bg-primary': currentStep >= 3}"></div>
      <div class="flex flex-col items-center">
        <div [ngClass]="{'bg-primary text-white': currentStep >= 3, 'bg-gray-200 text-gray-500': currentStep < 3}" class="flex items-center justify-center w-10 h-10 rounded-full">
          3
        </div>
        <span class="text-sm mt-2">New Password</span>
      </div>
    </div>
  </div>
</form>